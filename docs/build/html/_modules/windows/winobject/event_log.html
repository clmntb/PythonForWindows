
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>windows.winobject.event_log &#8212; PythonForWindows 0.4 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/mbasic.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PythonForWindows 0.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for windows.winobject.event_log</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">xml.dom.minidom</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>

<span class="kn">import</span> <span class="nn">windows</span>
<span class="kn">import</span> <span class="nn">windows.generated_def</span> <span class="k">as</span> <span class="nn">gdef</span>
<span class="kn">from</span> <span class="nn">windows</span> <span class="k">import</span> <span class="n">winproxy</span>


<span class="c1"># Helpers</span>

<span class="nd">@contextmanager</span>
<span class="k">def</span> <span class="nf">ClosingEvtHandle</span><span class="p">(</span><span class="n">handle</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">handle</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtClose</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>


<span class="c1"># low-level api helpers</span>
<span class="k">def</span> <span class="nf">queryinfo</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">evt</span> <span class="o">=</span> <span class="n">ImprovedEVT_VARIANT</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetLogInfo</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">evt</span>

<span class="k">def</span> <span class="nf">arrayproperty</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="n">evt</span> <span class="o">=</span> <span class="n">ImprovedEVT_VARIANT</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetObjectArrayProperty</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">evt</span>

<span class="k">def</span> <span class="nf">generate_query_function</span><span class="p">(</span><span class="n">query_function</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">generated_query_function</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x10000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">evt</span> <span class="o">=</span> <span class="n">ImprovedEVT_VARIANT</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="n">query_function</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">propertyid</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">evt</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">evt</span>
    <span class="k">return</span> <span class="n">generated_query_function</span>

<span class="n">chaninfo</span> <span class="o">=</span> <span class="n">generate_query_function</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetChannelConfigProperty</span><span class="p">)</span>
<span class="n">eventinfo</span> <span class="o">=</span> <span class="n">generate_query_function</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetEventMetadataProperty</span><span class="p">)</span>
<span class="n">publishinfo</span> <span class="o">=</span> <span class="n">generate_query_function</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetPublisherMetadataProperty</span><span class="p">)</span>


<span class="c1"># Class high-level API</span>
<div class="viewcode-block" id="EvtQuery"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtQuery">[docs]</a><span class="k">class</span> <span class="nc">EvtQuery</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_HANDLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent an Event-log query&quot;&quot;&quot;</span>
    <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mh">0x1000</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EvtQuery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>

    <span class="k">def</span> <span class="nf">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the next :class:`EvtEvent` matching the query&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">EvtEvent</span><span class="p">(</span><span class="n">channel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">)</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
            <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNext</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">==</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">StopIteration</span>
            <span class="k">raise</span>
        <span class="k">assert</span> <span class="n">ret</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span>  <span class="n">event</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="nb">next</span> <span class="o">=</span> <span class="fm">__next__</span> <span class="c1"># Yep.. real name is &#39;next&#39; in Py2 :D</span>

<div class="viewcode-block" id="EvtQuery.all"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtQuery.all">[docs]</a>    <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># SqlAlchemy like :)</span>
        <span class="sd">&quot;&quot;&quot;Return a list with all the query results</span>

<span class="sd">        :rtype: [:class:`EvtEvent`] -- A list of Event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="EvtEvent"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtEvent">[docs]</a><span class="k">class</span> <span class="nc">EvtEvent</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_HANDLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An Event log&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">EvtEvent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>

    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">rtype</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x10000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">rsize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="n">elementnb</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtRender</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">rtype</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">rsize</span><span class="p">,</span> <span class="n">elementnb</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_INSUFFICIENT_BUFFER</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">rsize</span><span class="o">.</span><span class="n">value</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtRender</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">rtype</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">rsize</span><span class="p">,</span> <span class="n">elementnb</span><span class="p">)</span>
        <span class="c1"># Adapting return value type</span>
        <span class="k">if</span> <span class="n">rtype</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">:</span>
            <span class="c1"># import pdb;pdb.set_trace()</span>
            <span class="c1"># assert elementnb.value == 1</span>
            <span class="k">return</span> <span class="n">buffer</span><span class="p">[:</span><span class="n">rsize</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
        <span class="c1"># print(&quot;Got &lt;{0}&gt; elt&quot;.format(elementnb.value))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">((</span><span class="n">ImprovedEVT_VARIANT</span> <span class="o">*</span> <span class="n">elementnb</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">from_buffer</span><span class="p">(</span><span class="n">buffer</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">render_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-16&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">xml</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">xml</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="EvtEvent.value"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtEvent.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve a value from the event.</span>
<span class="sd">        ``name`` is an XPath expressions that uniquely identify a node or attribute in the event.</span>
<span class="sd">        (see https://msdn.microsoft.com/en-us/library/windows/desktop/aa385352(v=vs.85).aspx)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">((</span><span class="n">name</span><span class="p">,),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextValues</span><span class="p">):</span>
        <span class="n">nbelt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">pwstr_values</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span>
        <span class="n">pwstr_rarray</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span> <span class="o">*</span> <span class="n">nbelt</span><span class="p">)(</span><span class="o">*</span><span class="n">pwstr_values</span><span class="p">)</span>
        <span class="c1"># https://msdn.microsoft.com/en-us/library/windows/desktop/aa385352(v=vs.85).aspx</span>
        <span class="c1"># An array of XPath expressions that uniquely identify a node or attribute in the event that you want to render.</span>
        <span class="c1"># Each value wil return 1 node :)</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtCreateRenderContext</span><span class="p">(</span><span class="n">nbelt</span><span class="p">,</span> <span class="n">pwstr_rarray</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextValues</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">system_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># POC: use this for all @property based on system data ?</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtCreateRenderContext</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextSystem</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">event_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctx</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtCreateRenderContext</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderContextUser</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtRenderEventValues</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">result</span><span class="p">]</span>

    <span class="c1"># Properties arround common Event/System values</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The ID of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/EventID&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The version of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Version&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The level of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Level&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">opcode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The opcode of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Opcode&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_created</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The creation time of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/TimeCreated/@SystemTime&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The process ID of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Execution/@ProcessID&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The process ID of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s2">&quot;Event/System/Execution/@ThreadID&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The medata for the current Event</span>

<span class="sd">        :type: :class:`EventMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">get_event_metadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="c1"># Test</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># user/event specifique data</span>
        <span class="sd">&quot;&quot;&quot;A dict of EventData Name:Value for the current dict.</span>

<span class="sd">        :type: :class:`dict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># What about classic channels where there is no event_metadata ?</span>
        <span class="c1"># Return a dict with [0-1-2-3-4] as key ? raise ?</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">event_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_values</span><span class="p">())}</span>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">creation_time</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">datetime_from_filetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_created</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> id=&quot;</span><span class="si">{self.id}</span><span class="s1">&quot; time=&quot;</span><span class="si">{creation_time}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">creation_time</span><span class="o">=</span><span class="n">creation_time</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">ImprovedEVT_VARIANT</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT</span><span class="p">):</span>
    <span class="n">VALUE_MAPPER</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeNull</span>       <span class="p">:</span> <span class="s1">&#39;NoneValue&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeString</span>     <span class="p">:</span> <span class="s1">&#39;StringVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeAnsiString</span> <span class="p">:</span> <span class="s1">&#39;AnsiStringVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSByte</span>      <span class="p">:</span> <span class="s1">&#39;SByteVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeByte</span>       <span class="p">:</span> <span class="s1">&#39;ByteVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeInt16</span>      <span class="p">:</span> <span class="s1">&#39;Int16Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt16</span>     <span class="p">:</span> <span class="s1">&#39;UInt16Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeInt32</span>      <span class="p">:</span> <span class="s1">&#39;Int32Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt32</span>     <span class="p">:</span> <span class="s1">&#39;UInt32Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeInt64</span>      <span class="p">:</span> <span class="s1">&#39;Int64Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeUInt64</span>     <span class="p">:</span> <span class="s1">&#39;UInt64Val&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSingle</span>     <span class="p">:</span> <span class="s1">&#39;SingleVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeDouble</span>     <span class="p">:</span> <span class="s1">&#39;DoubleVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeBoolean</span>    <span class="p">:</span> <span class="s1">&#39;BooleanVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeBinary</span>     <span class="p">:</span> <span class="s1">&#39;BinaryVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeGuid</span>       <span class="p">:</span> <span class="s1">&#39;GuidVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSizeT</span>      <span class="p">:</span> <span class="s1">&#39;SizeTVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeFileTime</span>   <span class="p">:</span> <span class="s1">&#39;FileTimeVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSysTime</span>    <span class="p">:</span> <span class="s1">&#39;SysTimeVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeSid</span>        <span class="p">:</span> <span class="s1">&#39;SidVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeHexInt32</span>   <span class="p">:</span> <span class="s1">&#39;BinaryVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeHexInt64</span>   <span class="p">:</span> <span class="s1">&#39;BinaryVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeEvtHandle</span>  <span class="p">:</span> <span class="s1">&#39;EvtHandleVal&#39;</span><span class="p">,</span>
        <span class="n">gdef</span><span class="o">.</span><span class="n">EvtVarTypeEvtXml</span>     <span class="p">:</span> <span class="s1">&#39;XmlVal&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">NoneValue</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">raw_type</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ImprovedEVT_VARIANT</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">Type</span>
        <span class="k">return</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EVT_VARIANT_TYPE</span><span class="o">.</span><span class="n">mapper</span><span class="p">[</span><span class="n">raw_type</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># Prototype !!</span>
        <span class="n">attrname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VALUE_MAPPER</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">]</span>
        <span class="c1"># print(&quot;Resolve type &lt;{0}&gt; -&gt; {1}&quot;.format(self.Type, attrname))</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrname</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{0}</span><span class="s2"> of type=</span><span class="si">{1}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Type</span><span class="p">)</span>






<span class="c1"># x = windows.winproxy.EvtQuery(None,</span>
                <span class="c1"># &quot;Microsoft-Windows-Windows Firewall With Advanced Security/Firewall&quot;,</span>
                <span class="c1"># &quot;Event/System[EventID=2004 or EventID=2006]&quot;,</span>
                <span class="c1"># gdef.EvtQueryChannelPath + gdef.EvtQueryForwardDirection)</span>
<span class="c1"># print(x)</span>
<span class="c1"># eq = EvtQuery(x)</span>
<span class="c1"># event = next(eq)</span>

<span class="c1"># xx = gdef.LPWSTR(&quot;ModifyingApplication&quot;)</span>
<span class="c1"># xx = gdef.LPWSTR(&quot;Event/System/Channel&quot;)</span>
<span class="c1"># xx = gdef.LPWSTR(&#39;Event/EventData/Data[@Name=&quot;ModifyingApplication&quot;]&#39;)</span>
<span class="c1"># xx = gdef.LPWSTR(&#39;Event/System/EventID&#39;)</span>

<span class="c1"># event = next(eq)</span>

<span class="c1"># list(channels())</span>

<div class="viewcode-block" id="EvtChannel"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtChannel">[docs]</a><span class="k">class</span> <span class="nc">EvtChannel</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An Event Log channel&quot;&quot;&quot;</span>
    <span class="n">DEFAULT_QUERY_FLAGS</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryChannelPath</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryForwardDirection</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="EvtChannel.query"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtChannel.query">[docs]</a>    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Query the event with the ``ids`` or perform a query with the raw query ``filter``</span>

<span class="sd">        Both parameters are mutually exclusive.</span>

<span class="sd">        .. note:: Here are some query examples</span>

<span class="sd">            List all events with a event data attribute named &#39;RuleName&#39;:</span>
<span class="sd">                ``Event/EventData/Data[@Name=&#39;RuleName&#39;]``</span>

<span class="sd">            List all events with a event data value of &#39;C:\\\\WINDOWS\\\\System32\\\\svchost.exe&#39;:</span>
<span class="sd">                ``Event/EventData[Data=&#39;C:\\WINDOWS\\System32\\svchost.exe&#39;]``</span>

<span class="sd">            List all events with an EventID of 2006:</span>
<span class="sd">                ``Event/System[EventID=2006]``</span>

<span class="sd">        :rtype: :class:`EvtQuery`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">and</span> <span class="nb">filter</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&lt;ids&gt; and &lt;filter&gt; are mutually exclusive&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="p">(</span><span class="n">long</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
                <span class="n">ids</span> <span class="o">=</span> <span class="p">(</span><span class="n">ids</span><span class="p">,)</span>
            <span class="n">ids_filter</span> <span class="o">=</span> <span class="s2">&quot; or &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;EventID=</span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span> <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ids</span><span class="p">)</span>
            <span class="nb">filter</span> <span class="o">=</span> <span class="s2">&quot;Event/System[</span><span class="si">{0}</span><span class="s2">]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ids_filter</span><span class="p">)</span>
        <span class="n">query_handle</span> <span class="o">=</span> <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtQuery</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_QUERY_FLAGS</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">EvtQuery</span><span class="p">(</span><span class="n">query_handle</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The list of all events in the channels, an alias for ``channel.query().all()``</span>

<span class="sd">        :type: [:class:`EvtEvent`] -- A list of :class:`EvtEvent`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The configuration of the channel</span>

<span class="sd">        :type: :class:`ChannelConfig`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ChannelConfig</span><span class="o">.</span><span class="n">from_channel_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="EvtChannel.get_event_metadata"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtChannel.get_event_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the metadata for the event ID ``id``</span>

<span class="sd">        :rtype: :class:`EventMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">pub_metada</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">publisher</span><span class="o">.</span><span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span> <span class="o">=</span> <span class="p">{</span><span class="n">evtm</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">evtm</span> <span class="k">for</span> <span class="n">evtm</span> <span class="ow">in</span> <span class="n">pub_metada</span><span class="o">.</span><span class="n">events_metadata</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_metadata_by_id</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="EvtFile"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtFile">[docs]</a><span class="k">class</span> <span class="nc">EvtFile</span><span class="p">(</span><span class="n">EvtChannel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represent an Evtx file&quot;&quot;&quot;</span>
    <span class="n">DEFAULT_QUERY_FLAGS</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryFilePath</span> <span class="o">+</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtQueryForwardDirection</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not implemented for EvtFile</span>

<span class="sd">        :raise: :class:`NotImplementedError`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Cannot retrieve the configuration of an EvtFile&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChannelConfig"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.ChannelConfig">[docs]</a><span class="k">class</span> <span class="nc">ChannelConfig</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_HANDLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The configuration of a event channel&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ChannelConfig</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="ChannelConfig.from_channel_name"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.ChannelConfig.from_channel_name">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_channel_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the :class:`ChannelConfig` for the channel ``name``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenChannelConfig</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publisher</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The :class:`EvtPublisher` for the channel&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">EvtPublisher</span><span class="p">(</span><span class="n">chaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtChannelConfigOwningPublisher</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">classic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;``True`` if the channel is a classic event channel (for example the Application or System log)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">chaninfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtChannelConfigClassicEventlog</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="EvtPublisher"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtPublisher">[docs]</a><span class="k">class</span> <span class="nc">EvtPublisher</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An Event provider&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the metadata for this publisher</span>

<span class="sd">        :type: :class:`PublisherMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PublisherMetadata</span><span class="o">.</span><span class="n">from_publisher_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="PublisherMetadata"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PublisherMetadata">[docs]</a><span class="k">class</span> <span class="nc">PublisherMetadata</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_HANDLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The metadata about an event provider&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PublisherMetadata</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="PublisherMetadata.from_publisher_name"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PublisherMetadata.from_publisher_name">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_publisher_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The :class:`PublisherMetadata` for the publisher ``name``&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenPublisherMetadata</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">name</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">chanrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identifies the channels child element of the provider.</span>

<span class="sd">        :type: :class:`PropertyArray`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">PropertyArray</span><span class="p">(</span><span class="n">publishinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferences</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">events_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The :class:`EventMetadata` for each event this provider defines</span>

<span class="sd">        :yield: :class:`EventMetadata`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eh</span> <span class="o">=</span> <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenEventMetadataEnum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">ClosingEvtHandle</span><span class="p">(</span><span class="n">eh</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">nh</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNextEventMetadata</span><span class="p">(</span><span class="n">eh</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">EventMetadata</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">break</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channel_name_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The dict of channel defined by this provider by their id</span>

<span class="sd">        :type: :class:`dict`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chansref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chanrefs</span>
        <span class="n">channame_by_value_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chansref</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">chansref</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferenceID</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">chansref</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferencePath</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">channame_by_value_id</span><span class="p">[</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="n">channame_by_value_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The list of :class:`EvtChannel` defined by this provider</span>

<span class="sd">        :type: [:class:`EvtChannel`] -- A list of :class:`EvtChannel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chansref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chanrefs</span>
        <span class="n">propertyid</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtPublisherMetadataChannelReferencePath</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">EvtChannel</span><span class="p">(</span><span class="n">chansref</span><span class="o">.</span><span class="n">property</span><span class="p">(</span><span class="n">propertyid</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">chansref</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

<div class="viewcode-block" id="PublisherMetadata.message"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PublisherMetadata.message">[docs]</a>    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgid</span><span class="p">):</span>
        <span class="s2">&quot;TODO&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">sbuff</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">LPWSTR</span><span class="p">)</span>
        <span class="n">outsize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">winproxy</span><span class="o">.</span><span class="n">EvtFormatMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">msgid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EvtFormatMessageId</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">sbuff</span><span class="p">,</span> <span class="n">outsize</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_EVT_UNRESOLVED_VALUE_INSERT</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">sbuff</span><span class="o">.</span><span class="n">value</span></div>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">{0}</span><span class="s1"> &quot;</span><span class="si">{1}</span><span class="s1">&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span></div>


<div class="viewcode-block" id="PropertyArray"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.PropertyArray">[docs]</a><span class="k">class</span> <span class="nc">PropertyArray</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_OBJECT_ARRAY_PROPERTY_HANDLE</span><span class="p">):</span>
    <span class="s2">&quot;TODO&quot;</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">array_size</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtGetObjectArraySize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array_size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array_size</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">arrayproperty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="EventMetadata"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EventMetadata">[docs]</a><span class="k">class</span> <span class="nc">EventMetadata</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">EVT_HANDLE</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The Metadata about a given Event type</span>


<span class="sd">    see: https://msdn.microsoft.com/en-us/library/windows/desktop/aa385517(v=vs.85).aspx</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The ID of the Event&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventID</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channel_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The the Channel attribute of the Event definition&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventChannel</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identifies the message attribute of the event definition.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventMessageID</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">template</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Identifies the template attribute of the event definition which is an XML string&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">eventinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gdef</span><span class="o">.</span><span class="n">EventMetadataEventTemplate</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">event_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The list of attribute specifique for this event.</span>
<span class="sd">        Retrieved by parsing :data:`EventMetadata.template`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">template</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">xmltemplate</span> <span class="o">=</span> <span class="n">xml</span><span class="o">.</span><span class="n">dom</span><span class="o">.</span><span class="n">minidom</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">xmltemplate</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="EvtlogManager"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager">[docs]</a><span class="k">class</span> <span class="nc">EvtlogManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The main Evt class to open Evt channel/publisher and evtx file&quot;&quot;&quot;</span>
    <span class="c1"># https://msdn.microsoft.com/en-us/library/windows/desktop/aa385784(v=vs.85).aspx</span>

<div class="viewcode-block" id="EvtlogManager.is_implemented"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.is_implemented">[docs]</a>    <span class="k">def</span> <span class="nf">is_implemented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return ``True`` if the new Evt-API is implemented on the current computer</span>

<span class="sd">        see: https://msdn.microsoft.com/en-us/library/windows/desktop/aa385784(v=vs.85).aspx</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">is_implemented</span><span class="p">(</span><span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtQuery</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenChannelEnum</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ressize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">ClosingEvtHandle</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNextChannelPath</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">ressize</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">return</span>
                <span class="k">assert</span> <span class="n">buffer</span><span class="p">[</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[:</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">chan</span> <span class="o">=</span> <span class="n">EvtChannel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">chan</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">publishers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtOpenPublisherEnum</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mh">0x1000</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_unicode_buffer</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">ressize</span> <span class="o">=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">DWORD</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">ClosingEvtHandle</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">windows</span><span class="o">.</span><span class="n">winproxy</span><span class="o">.</span><span class="n">EvtNextPublisherId</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">ressize</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">winerror</span> <span class="o">!=</span> <span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_NO_MORE_ITEMS</span><span class="p">:</span>
                        <span class="k">raise</span>
                    <span class="k">return</span>
                <span class="k">assert</span> <span class="n">buffer</span><span class="p">[</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[:</span><span class="n">ressize</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">publisher</span> <span class="o">=</span> <span class="n">EvtPublisher</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">publisher</span>



<div class="viewcode-block" id="EvtlogManager.open_channel"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.open_channel">[docs]</a>    <span class="k">def</span> <span class="nf">open_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the Evt channel with ``name``</span>

<span class="sd">        :rtype: :class:`EvtChannel`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chan</span> <span class="o">=</span> <span class="n">EvtChannel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">chan</span><span class="o">.</span><span class="n">config</span> <span class="c1"># Force to retrieve a handle (check channel exists)</span>
        <span class="k">return</span> <span class="n">chan</span></div>

<div class="viewcode-block" id="EvtlogManager.open_evtx_file"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.open_evtx_file">[docs]</a>    <span class="k">def</span> <span class="nf">open_evtx_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the evtx file with ``filename``</span>

<span class="sd">        :rtype: :class:`EvtFile`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">windows</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">DisableWow64FsRedirection</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">WindowsError</span><span class="p">(</span><span class="n">gdef</span><span class="o">.</span><span class="n">ERROR_FILE_NOT_FOUND</span><span class="p">,</span> <span class="s2">&quot;Could not find file &lt;</span><span class="si">{0}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">EvtFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file</span></div>

<div class="viewcode-block" id="EvtlogManager.open_publisher"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.open_publisher">[docs]</a>    <span class="k">def</span> <span class="nf">open_publisher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the Evt publisher with ``name``</span>

<span class="sd">        :rtype: :class:`EvtPublisher`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">publisher</span> <span class="o">=</span> <span class="n">EvtPublisher</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">publisher</span><span class="o">.</span><span class="n">metadata</span> <span class="c1"># Force to retrieve a handle (check channel exists)</span>
        <span class="k">return</span> <span class="n">publisher</span></div>

<div class="viewcode-block" id="EvtlogManager.__getitem__"><a class="viewcode-back" href="../../../evtlog.html#windows.winobject.event_log.EvtlogManager.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open the Evt Channel/Publisher or Evtx file with ``name``</span>

<span class="sd">        :rtype: :class:`EvtChannel` or :class:`EvtPublisher` or :class:`EvtFile`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_channel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_publisher</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">WindowsError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="c1"># Raise FILE_NOT_FOUND if not found (last chance)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_evtx_file</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div></div>




<span class="c1"># CHANNAME = &quot;Microsoft-Windows-Windows Firewall With Advanced Security/Firewall&quot;</span>
<span class="c1"># CHANNAME = r&quot;Microsoft-Windows-Windows Defender/Operational&quot;</span>

<span class="c1"># print(&quot;Working of channel: &lt;{0}&gt;&quot;.format(CHANNAME))</span>

<span class="c1"># channel = EvtChannel(CHANNAME)</span>
<span class="c1"># chanconf = channel.config</span>
<span class="c1"># publisher = chanconf.publisher</span>

<span class="c1"># open publisher metadata</span>

<span class="c1"># print(&quot;Provider is &lt;{0}&gt;&quot;.format(publisher.name))</span>

<span class="c1"># pmd = publisher.metadata</span>
<span class="c1"># chansref = pmd.chanrefs</span>

<span class="c1"># channame_by_value_id  = pmd.channel_name_by_id()</span>

<span class="c1"># for event_metadata in pmd.events_metadata:</span>
     <span class="c1"># id = event_metadata.id</span>
     <span class="c1"># if id == 2004:</span>
        <span class="c1"># print(&quot;LOL&quot;)</span>
     <span class="c1"># chan = event_metadata.channel_id</span>
     <span class="c1"># channame = channame_by_value_id[chan]</span>
     <span class="c1"># print(&quot;   * {0}) {1}&quot;.format(id, channame))</span>
     <span class="c1"># if &quot;unexpected&quot; in pmd.message(event_metadata.message_id).lower():</span>
        <span class="c1"># print(&quot;UNEXPECTED in message :D&quot;)</span>


<span class="c1"># query = channel.query(ids=5008)</span>
<span class="c1"># evts = list(query)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PythonForWindows 0.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Clement Rouault.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>